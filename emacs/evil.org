#+auto_tangle: y

* Install Evil

#+begin_src emacs-lisp :tangle yes
  ;; ===============================================================================
  ;; configure evil mode
  ;; ===============================================================================

  (use-package evil
    :straight t
    :config
    (use-package evil-surround
      :straight t
      :config
      (global-evil-surround-mode 1))
    (use-package evil-matchit
      :straight t
      :config
      (global-evil-matchit-mode 1))
    (evil-mode 1)
    (setq evil-want-fine-undo t)
    (add-hook 'org-capture-mode-hook 'evil-insert-state) ;; use insert by default for org capture
    (add-hook 'git-commit-mode-hook 'evil-insert-state) ;; use insert mode by default for magit commits
    (when (dirvish-override-dired-mode))
      (evil-set-initial-state 'dired-mode 'emacs)
    (use-package goto-chg
      :straight t))

  ;; add visual indicators for common vim commands
  (use-package evil-goggles
    :straight t
    :config
    (evil-goggles-mode))

  (use-package evil-args
    :straight t
    :config
    (define-key evil-inner-text-objects-map "a" 'evil-inner-arg)
    (define-key evil-outer-text-objects-map "a" 'evil-inner-arg)
    (define-key evil-normal-state-map "L" 'evil-forward-arg)
    (define-key evil-normal-state-map "H" 'evil-backward-arg)
    (define-key evil-motion-state-map "L" 'evil-forward-arg)
    (define-key evil-motion-state-map "H" 'evil-backward-arg)
    (define-key evil-normal-state-map "K" 'evil-jump-out-args))
#+end_src

* Configure "Spacemacs" Style Keybindings

#+begin_src emacs-lisp :tangle yes
  (defun my-split-or-switch-window-left ()
    "Create a new window on the left and open dired, if a window already exists move there"
    (interactive)
    (if (= 1 (count-windows))
        (progn
          (split-window-horizontally)
          (dired-jump nil))
      (progn
        (evil-window-left 1))))


  (defun my-split-or-switch-window-right ()
    "Create a new window on the right and open dired, if a window already exists move there"
    (interactive)
    (if (= 1 (count-windows))
        (progn
          (split-window-horizontally)
          (other-window 1)
          (dired-jump nil))
      (progn
        (evil-window-right 1))))
#+end_src

#+begin_src emacs-lisp :tangle yes
  (defun my-find-implementation-or-test-other-window ()
    "Finds the corresponding test or implementation window and opens it in a new or existing horizontal split"
    (interactive)
    (let ((file (projectile-find-implementation-or-test (buffer-file-name))))
      (if file
          (progn (my-split-or-switch-window-right) (find-file file)))))
#+end_src

#+begin_src emacs-lisp :tangle yes
  ;; Core/global bindings (applied immediately)
  (evil-define-key 'normal 'global (kbd "<SPC> w c") 'delete-window)
  (evil-define-key 'normal 'global (kbd "<SPC> w v") 'split-window-vertically)
  (evil-define-key 'normal 'global (kbd "<SPC> w j") 'evil-window-down)
  (evil-define-key 'normal 'global (kbd "<SPC> w k") 'evil-window-up)
  (evil-define-key 'normal 'global (kbd "<SPC> <SPC> j") 'previous-buffer)
  (evil-define-key 'normal 'global (kbd "<SPC> <SPC> k") 'next-buffer)
  (evil-define-key 'normal 'global (kbd "<SPC> x") 'kill-this-buffer)
  
  (evil-define-key 'normal 'global (kbd "<SPC> d") 'dired-jump)
  (evil-define-key 'normal 'global (kbd "<SPC> w h") 'my-split-or-switch-window-left)
  (evil-define-key 'normal 'global (kbd "<SPC> w l") 'my-split-or-switch-window-right)

  ;; Hydra bindings
  (with-eval-after-load 'hydra
    (evil-define-key 'normal 'global (kbd "<SPC> <SPC> h") 'hydra-main/body))

  ;; Org mode bindings
  (with-eval-after-load 'org
    ;; Global org bindings
    (evil-define-key 'normal 'global (kbd "<SPC> e") 'org-babel-execute-src-block)
    (evil-define-key 'normal 'global (kbd "<SPC> s l") 'org-store-link)
    (evil-define-key 'normal 'global (kbd "<SPC> i l") 'org-insert-link)
    
    ;; Org mode map specific bindings
    (evil-define-key 'normal org-mode-map (kbd "<SPC> h") 'org-insert-heading)
    (evil-define-key 'normal org-mode-map (kbd "<SPC> H") 'org-insert-subheading))

  ;; Org-roam bindings
  (with-eval-after-load 'org-roam
    (evil-define-key 'normal 'global (kbd "<SPC> n") 'org-roam-node-find)
    (evil-define-key 'normal 'global (kbd "<SPC> j") 'org-roam-dailies-goto-today))

  ;; Projectile bindings
  (with-eval-after-load 'projectile
    ;; Global projectile bindings
    (evil-define-key 'normal 'global (kbd "<SPC> r") 'projectile-ripgrep)
    (evil-define-key 'normal 'global (kbd "<SPC> f") 'project-find-file)
    (evil-define-key 'normal 'global (kbd "<SPC> p p") 'consult-projectile-switch-project)
    
    ;; Python mode specific bindings
    (evil-define-key 'normal python-mode-map (kbd "<SPC> T") 'my-find-implementation-or-test-other-window))

  ;; Magit bindings
  (with-eval-after-load 'magit
    (evil-define-key 'normal 'global (kbd "<SPC> g") 'magit)
    (evil-define-key 'normal 'global (kbd "<SPC> g s") 'magit-status)
    (evil-define-key 'normal 'global (kbd "<SPC> g b") 'magit-blame)
    (evil-define-key 'normal 'global (kbd "<SPC> g l") 'magit-log)
    (evil-define-key 'normal 'global (kbd "<SPC> g f") 'magit-file-dispatch)
    (evil-define-key 'normal 'global (kbd "<SPC> g d") 'magit-diff-buffer-file)
    (evil-define-key 'normal 'global (kbd "<SPC> g c") 'magit-commit)
    (evil-define-key 'normal 'global (kbd "<SPC> g p") 'magit-push))

  ;; Consult bindings
  (with-eval-after-load 'consult
    (evil-define-key 'normal 'global (kbd "<SPC> b") 'consult-bookmark)
    (evil-define-key 'normal 'global (kbd "<SPC> o") 'consult-buffer)
    (evil-define-key 'normal 'global (kbd "<SPC> m m") 'consult-imenu-multi)
    (evil-define-key 'normal 'global (kbd "<SPC> m i") 'consult-imenu))

  ;; Perspective bindings
  (with-eval-after-load 'perspective
    (evil-define-key 'normal 'global (kbd "<SPC> p s") 'persp-switch)
    (evil-define-key 'normal 'global (kbd "<SPC> p S") 'persp-state-save)
    (evil-define-key 'normal 'global (kbd "<SPC> p L") 'persp-state-load))

  ;; Tab-bar bindings
  (with-eval-after-load 'tab-bar
    (evil-define-key 'normal 'global (kbd "<SPC> t") 'tab-switch))
#+end_src 

